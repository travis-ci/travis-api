<section class="info-block">
  <h2 class="info-header">Status</h2>

  <dl class="simple-info">
    <dt class="info-label">State:</dt>
    <dd>
      <%= @build.state %>
      <% if @build.not_finished? %>
          <%= button_to "Cancel", cancel_build_path(@build), form_class: "reset-button", class: "button" %>
      <% else %>
          <%= button_to "Restart", restart_build_path(@build), form_class: "reset-button", class: "button" %>
      <% end %>
    </dd>

    <dt class="info-label">Previous State:</dt>
    <dd><%= @build.previous_state %></dd>

    <dt class="info-label">Repository:</dt>
    <dd><%= link_to describe(@build.repository), @build.repository %></dd>

    <dt class="info-label">Request:</dt>
    <dd><%= link_to describe(@build.request), @build.request %></dd>

    <dt class="info-label">Owner:</dt>
    <dd>
      <% if @build.owner.avatar_url %>
        <%= image_tag(@build.owner.avatar_url, size: "20x20", alt: "Avatar", class: "avatar") %>
      <% end %>
      <%= link_to describe(@build.owner), @build.owner %>
    </dd>

    <dt class="info-label">Event Type:</dt>
    <dd><%= @build.event_type %></dd>

    <dt class="info-label">Created:</dt>
    <dd><time><%= @build.created_at %></time></dd>

    <dt class="info-label">Started:</dt>
    <dd><time><%= @build.started_at %></time></dd>

    <dt class="info-label">Finished:</dt>
    <dd><time><%= @build.finished_at %></time></dd>

    <dt class="info-label">Duration:</dt>
    <dd><%= format_duration(@build.duration) %></dd>

    <dt class="info-label">Branch:</dt>
    <dd><%= @build.branch %></dd>

    <dt class="info-label">Commit:</dt>
    <dd><%= @build.commit.commit %></dd>

    <dt class="info-label">Message:</dt>
    <dd><%= @build.commit.message %></dd>

    <dt class="info-label">Committer:</dt>
    <dd class="inline-list committer">
      <p>
        <%= @build.commit.committer_name %>
        <%= mail_to @build.commit.committer_email, fa_icon("envelope-o") %>
      </p>

      <div>
        <%= form_tag(search_path, method: :get) do %>
          <%= hidden_field_tag(:q, @build.commit.committer_email) %>
          <%= button_to options = nil, class: "button", id: "search-committer_email" do %>
            <%= fa_icon("search") %> Email
          <% end %>
        <% end %>

        <%= form_tag(search_path, method: :get) do %>
          <%= hidden_field_tag(:q, @build.commit.committer_name) %>
          <%= button_to options = nil, class: "button", id: "search-committer_name" do %>
            <%= fa_icon("search") %> Name
          <% end %>
        <% end %>
      </div>
    </dd>

    <dt class="info-label">Author:</dt>
    <dd class="inline-list author">
      <p>
        <%= @build.commit.author_name %>
        <%= mail_to @build.commit.author_email, fa_icon("envelope-o") %>
      </p>

      <div>
        <%= form_tag(search_path, method: :get) do %>
          <%= hidden_field_tag(:q, @build.commit.author_name) %>
          <%= button_to options = nil, class: "button", id: "search-author_email" do %>
            <%= fa_icon("search") %> Email
          <% end %>
        <% end %>

        <%= form_tag(search_path, method: :get) do %>
          <%= hidden_field_tag(:q, @build.commit.author_name) %>
          <%= button_to options = nil, class: "button", id: "search-author_name" do %>
            <%= fa_icon("search") %> Name
          <% end %>
        <% end %>
      </div>
    </dd>

    <dt class="info-label">Config Status:</dt>
    <dd><%= @build.config ? @build.config_result : 'pending' %></dd>
  </dl>
</section>

<section class="info-block">
  <h2 class="info-header">Matrix</h2>
  <%= render partial: 'shared/job_list', locals: {jobs: @jobs} %>
</section>
