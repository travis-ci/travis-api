<section class="info-block">
  <h2 class="info-header">Basic information</h2>

  <dl class="simple-info">
    <dt class="info-label">Name</dt>
    <dd>
      <%= link_to describe(@repository), vcs_repo_url(@repository), target: '_blank' %>
    </dd>

    <dt class="info-label">VCS Type</dt>
    <dd>
      <%= @repository.vcs_type %>
      (
      <%= link_to @repository.slug, vcs_repo_url(@repository), target: '_blank' %>
      )
    </dd>

    <dt class="info-label">Description</dt>
    <dd><%= @repository.description %></dd>

    <dt class="info-label">Visibility</dt>
    <dd><%= @repository.private? ? "private" : "public" %></dd>

    <dt class="info-label">Default branch:</dt>
    <dd><%= @repository.default_branch %></dd>

    <dt class="info-label">Repository owner</dt>
    <dd>
      <%= image_tag(@repository.owner.avatar_url, size: "20x20", alt: "Avatar", class: "avatar") if @repository.owner.avatar_url %>
      <%= link_to describe(@repository.owner), @repository.owner %>
    </dd>
    <dt class="info-label">Active admin</dt>
    <dd>
      <% if @active_admin %>
        <%= image_tag(@active_admin.avatar_url, size: "20x20", alt: "Avatar", class: "avatar") if @active_admin.avatar_url %>
        <%= link_to describe(@active_admin), @active_admin %>
        <%= link_to fa_icon("users", title: "More admins"), '#users' if @repository.permissions_sorted[:admin].size > 1 %>
      <% else %>
        <%= fa_icon("exclamation-triangle", title: "Warning") %> no admin
      <% end %>
    </dd>
    <div class="vcs-integration-container">
      <dt class="info-label">VCS ID</dt>
      <dd><%= @repository.vcs_id %></dd>

      <dt class="info-label">VCS Integration</dt>
      <dd class="inline">
        <% if @repository.managed_by_installation_at.present? %>
          This repo uses a VCS App Installation
        <% else %>
          This repo uses a Service Hook
          <div class="inline">
            <%= button_to "Check hook", check_hook_repository_path(@repository),
                          form_class: "check-hook",
                          disabled: !@repository.find_admin,
                          title: "Action requires active admin.",
                          class: "button" %>
          </div>
        <% end %>
      </dd>
    </div>
    <div class="activation-container">
      <% if @repository.managed_by_installation_at.present? %>
        <dt class="info-label">Active on .com</dt>
        <dd>This repo is active on .com</dd>
      <% else %>
        <dt class="info-label">Activation</dt>
        <dd class="inline">
          <%= @repository.active? ? 'enabled' : 'disable' %>
          <div class="inline">
            <% if @repository.active? %>
              <%= button_to "Disable", disable_repository_path(@repository), form_class: "disable-button", class: "button" %>
            <% else %>
              <%= button_to "Enable", enable_repository_path(@repository), form_class: "enable-button", class: "button" %>
            <% end %>
          </div>
        </dd>
      <% end %>
    </div>
    <div class="build-tracing-container">
      <% if ENV['BUILD_TRACE_GOOGLE_PROJECT'] %>
        <dt class="info-label">Build Tracing</dt>
        <dd class="inline">
          <%= has_trace_rollout_repos?(@repository) ? 'enabled' : 'disabled' %>
          <div class="inline">
            <%= button_to "View Traces", list_repository_trace_url(@repository), method: :post, class: "button" %>
            <% if has_trace_rollout_repos?(@repository) %>
              <%= button_to "Disable", disable_repository_trace_url(@repository), method: :post, class: "button" %>
            <% else %>
              <%= button_to "Enable", enable_repository_trace_url(@repository), method: :post, class: "button" %>
            <% end %>
          </div>
        </dd>
      <% end %>
    </div>
  </dl>
</section>

<section class="info-block">
  <h2 class="info-header">Status</h2>

    <dl class="simple-info">
    <dt class="info-label">Last build</dt>
    <dd class="inline">
      <% if @repository.last_build_id %>
        <div>
          <%= link_to "##{@repository.last_build_number}", @repository.last_build %>
          <%= "(#{@repository.last_build.state} at #{@repository.last_build.state_time})" %>
        </div>
        <%= form_tag({action: 'delete_last_build', controller: "repositories", id: @repository, method: 'post'}, {class: 'drop-build-button'}) do %>
          <%= render partial: "shared/otp" %>
          <%= submit_tag 'Drop', class: 'button otp', id: "drop-build" %>
        <% end %>
      <% else %>
        None.
      <% end %>
    </dd>
    <div class="active-container">
      <dt class="info-label">Active?</dt>
      <dd class="inline">
        <%= @repository.active? %>
        <div class="inline">
          <%= button_to "Check hook", check_hook_repository_path(@repository), form_class: "check-hook", disabled: !@repository.find_admin, title: "Action requires active admin.", class: "button" %>
          <% if @repository.active? %>
            <%= button_to "Test hook", test_hook_repository_path(@repository), form_class: "test-hook", disabled: !@repository.find_admin, title: "Action requires active admin.", class: "button" %>
            <%= button_to "Disable", disable_repository_path(@repository), form_class: "disable-button", class: "button" %>
          <% else %>
            <%= button_to "Enable", enable_repository_path(@repository), form_class: "enable-button", class: "button" %>
          <% end %>
        </div>
      </dd>
    </div>
  </dl>
</section>

<% unless travis_config.enterprise? %>
  <section class="info-block" id="feature-flags">
    <h2 class="info-header">Feature flags</h2>
    <%= render partial: 'shared/features_for', locals: {owner: @repository} %>
  </section>
<% end %>

<section class="info-block">
  <h2 class="info-header">Custom SSH key</h2>
    <p>
      <%= @repository.has_custom_ssh_key? ? "Yes" : "No"%>
    </p>
</section>

<section class="info-block">
  <h2 class="info-header">Settings</h2>
    <%= form_for :settings, url: {controller: "settings", action: "update"}, html: {class: "inline-list"} do |f| %>
  <div>
    <% Settings::BINARY.each do |key| %>
      <p>
        <%= f.check_box key, checked: @settings.send(key) %>
        <%= f.label key %>
      </p>
    <% end %>

    <% Settings::INTEGER.each do |key| %>
      <p>
        <%= f.text_field key, value: @settings.send(key) %>
        <%= f.label key %>
      </p>
    <% end %>
    </div>
  <%= f.submit('Update', class: 'button', id: 'update-settings') %>
<% end %>
</section>

<section class="info-block">
  <h2 class="info-header">Cron Jobs</h2>
  <% if @crons.present? %>
    <%= render 'crons' %>
  <% else %>
    <p>There are no Cron Jobs set</p>
  <% end %>
</section>
